# Pepper Files Microservice

–≠—Ç–æ—Ç –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –¥–ª—è —Å–∞–π—Ç–∞ –ø—Ä–æ –æ—Å—Ç—Ä—ã–µ –ø–µ—Ä—Ü—ã. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–µ–π –∏ –∞–≤–∞—Ç–∞—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –§–∞–π–ª—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ **MinIO** (S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ), –∞ –∏—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ **PostgreSQL**.

## üîß –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Express** ‚Äì –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è Node.js
- **MinIO** ‚Äì S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Ñ–∞–π–ª–æ–≤
- **PostgreSQL** ‚Äì –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∞–π–ª–∞—Ö
- **Multer** ‚Äì middleware –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
- **AWS SDK v3** ‚Äì –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å S3 (–∏ MinIO)

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```

project/
‚îÇ
‚îú‚îÄ‚îÄ config/
‚îÇ ‚îú‚îÄ‚îÄ db.js // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
‚îÇ ‚îî‚îÄ‚îÄ s3.js // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ MinIO (S3)
‚îÇ
‚îú‚îÄ‚îÄ controllers/
‚îÇ ‚îî‚îÄ‚îÄ fileController.js // –õ–æ–≥–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
‚îÇ
‚îú‚îÄ‚îÄ routes/
‚îÇ ‚îî‚îÄ‚îÄ fileRoutes.js // –†–æ—É—Ç—ã API
‚îÇ
‚îú‚îÄ‚îÄ middleware/
‚îÇ ‚îî‚îÄ‚îÄ upload.js // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Multer
‚îÇ
‚îú‚îÄ‚îÄ app.js // –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ server.js // –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ package.json // –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–∫—Ä–∏–ø—Ç—ã
‚îî‚îÄ‚îÄ .env // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
git clone <URL-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è>
cd project
npm install
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –¥–æ–±–∞–≤—å:

```env
DATABASE_URL=postgres://user:password@localhost:5432/yourdbname
MINIO_ENDPOINT=http://localhost:9000
MINIO_ACCESS_KEY=admin
MINIO_SECRET_KEY=secret
MINIO_BUCKET=pepper-files
PORT=3000
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL

–°–æ–∑–¥–∞–π –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ —Ç–∞–±–ª–∏—Ü—É `files`:

```sql
CREATE TABLE files (
  id SERIAL PRIMARY KEY,
  filename TEXT NOT NULL,
  mimetype TEXT,
  bucket TEXT,
  key TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 4. –ó–∞–ø—É—Å–∫ MinIO —á–µ—Ä–µ–∑ Docker

```bash
docker run -p 9000:9000 -p 9001:9001 --name minio \
  -e "MINIO_ROOT_USER=admin" \
  -e "MINIO_ROOT_PASSWORD=secret" \
  quay.io/minio/minio server /data --console-address ":9001"
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:

- **API MinIO** –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ [http://localhost:9000](http://localhost:9000)
- **–ö–æ–Ω—Å–æ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è** ‚Äî [http://localhost:9001](http://localhost:9001)

### 5. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
npm start
```

–°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ `http://localhost:3000`.

## üì° API

### üîº –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞

- **URL:** `/api/files/upload`
- **–ú–µ—Ç–æ–¥:** `POST`
- **–§–æ—Ä–º–∞—Ç:** `multipart/form-data`  
  **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
  - `file` ‚Äì –∑–∞–≥—Ä—É–∂–∞–µ–º—ã–π —Ñ–∞–π–ª

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**

```json
{
  "success": true,
  "fileId": 1
}
```

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

–ï—Å–ª–∏ —É —Ç–µ–±—è –µ—Å—Ç—å –∏–¥–µ–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –∏–ª–∏ —Ç—ã —Ö–æ—á–µ—à—å –≤–Ω–µ—Å—Ç–∏ —Å–≤–æ–π –≤–∫–ª–∞–¥, —Å–æ–∑–¥–∞–≤–∞–π pull request –∏–ª–∏ –æ—Ç–∫—Ä—ã–≤–∞–π issue.

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ [MIT License](LICENSE).
